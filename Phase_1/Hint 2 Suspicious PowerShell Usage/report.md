## ğŸš¨ Suspicious PowerShell Usage â€“ Malware Simulation

### ğŸ“Œ Objective
Simulate suspicious PowerShell and malware-like behavior on the attacker Windows VM and verify detection through SIEM tools (Sysmon + Winlogbeat + Elasticsearch + Kibana + ElastAlert).

---

### ğŸ§ª What Was Done

1. Created a PowerShell script (`malware-simulation.ps1`) that:
   - Created a directory for "malware".
   - Dropped a `.bat` file simulating a payload.
   - Added persistence via the registry and startup folder.
   - Launched the payload.
   - Made a simulated outbound HTTP request.
2. Malware Script:
  ![malware_script](https://github.com/user-attachments/assets/29521d96-17ae-4843-9e16-6bfbea4f5556)

3. Script executed using:
   ```powershell
   PowerShell -ExecutionPolicy Bypass -File C:\Scripts\malware-simulation.ps1
   ```

---

### ğŸ‘ï¸ What Was Observed in the Logs

âœ… Sysmon (via Event Viewer and Elasticsearch index `winlogbeat-*`) logged the following:

- **Event ID 1** â€“ Process creation (`cmd.exe` running `malware.bat`)
- **Event ID 11** â€“ File creation (`malware.bat`, `malware_startup.bat`)
- **Event ID 13** â€“ Registry key for persistence

---

### ğŸ§  How SIEM Flagged the Event

âœ”ï¸ **ElastAlert** was configured with a rule (`Suspicious PowerShell Usage - Malware Simulation.yaml`) to trigger if:

- Multiple Sysmon events (IDs 1, 11, or 13) were generated by PowerShell-related processes (`powershell.exe`, `cmd.exe`) with specific keywords like `malware.bat` or `Startup`.

âœ”ï¸ The alert matched 5+ events within the specified timeframe.

ğŸ“¨ **Email Alert Sent** to the configured address via SMTP (Gmail).

---

## ğŸ“Š Data Source Mapping

| Log Source     | Event Type         | Event ID | Description                              |
|----------------|--------------------|----------|------------------------------------------|
| Sysmon         | Process Creation   | 1        | Execution of `powershell.exe`, `cmd.exe` |
| Sysmon         | File Creation      | 11       | Dropping of `malware.bat`, startup file  |
| Sysmon         | Registry Change    | 13       | Creation of persistence registry key     |
| Winlogbeat     | Log Forwarding     | -        | Transmitted all events to Elasticsearch  |

## ğŸ“© Sample Alert (Email Screenshot)
![Screenshot 2025-05-21 223349](https://github.com/user-attachments/assets/77e5835a-5c9e-43f4-93bd-17433a5a8c8a)

### ğŸ›¡ï¸ Analyst Action on Alert

- âœ… Verified alert in ElastAlert logs.
- âœ… Correlated event IDs and command line arguments in Kibana Discover.
- âœ… Confirmed registry and file activity from the simulated script.
- âœ… Took note that `example.com` in outbound HTTP is harmless.

---

### âš ï¸ Possible False Positives

| ğŸ§© Impact Area          | ğŸ“Œ Description                                                                   |
|-------------------------|----------------------------------------------------------------------------------|
| ğŸ”” Alert Fatigue        | Analysts overwhelmed by frequent safe alerts.                                   |
| â± Time Waste            | Benign activity diverts attention from real threats.                            |
| ğŸ˜• Desensitization       | Important alerts may be overlooked if they resemble known false ones.           |
| ğŸ” Analytical Bias      | Assumption of false positive leads to oversight.                                 |
| ğŸ“‰ Reduced Trust        | In the alerting system or detection rule validity.                              |


ğŸ› ï¸ **Recommendation:** Whitelist known good script paths, users, or command-line arguments.

---

### ğŸ§ª Detection Status

**âœ… Successfully Triggered**

ğŸ“¬ **ElastAlert sent email alert** upon detecting the simulated PowerShell and malware behavior.
