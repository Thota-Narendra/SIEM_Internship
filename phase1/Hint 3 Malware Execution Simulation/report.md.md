# ğŸš¨ Malware Execution Simulation

## ğŸ“Œ Objective
Simulate malware execution on a Windows VM and detect related events using Sysmon, Winlogbeat, Elasticsearch, Kibana, and ElastAlert.

---

## ğŸ§ª What Was Done

1. **Simulated Malware Execution**:
   - Created a dummy `.bat` file with benign commands to simulate malware activity.
   - Executed the file from `Downloads` or `Temp` directory to trigger:
     - Sysmon **Event ID 1** â€“ Process Creation
     - Sysmon **Event ID 3** â€“ Network Connection


2. **Configured Sysmon to Log**:
   - `Event ID 1`: Process creation
   - `Event ID 3`: Network connections

3. **Winlogbeat Setup**:
   - Configured to forward relevant event logs to **Elasticsearch**.

4. **ElastAlert Rule Configuration**:
   - Created detection rules for process creation and network activity using Sysmon event IDs.

---

## ğŸ”¥ Example Script

    @echo off
    echo Simulating malware...
    ping 8.8.8.8 -n 10
## ğŸ‘ï¸ What Was Observed in the Logs


âœ… **Sysmon and Winlogbeat logs showed:**

- **Event ID 1** â€“ Process creation for the `.bat` file.
- **Event ID 3** â€“ Network connection from the `ping` command.

---

## ğŸ§  How SIEM Flagged the Event

âœ”ï¸ **ElastAlert** triggered alerts when:

- The batch file execution (**Event ID 1**) was detected.
- A network connection (**Event ID 3**) was established.
- Alerts were **aggregated within a time window** to reduce noise.

ğŸ“¨ **Email notifications** were sent to the security team for review.

---

## ğŸ“Š Data Source Mapping

| Log Source | Event Type         | Event ID | Description                            |
|------------|--------------------|----------|----------------------------------------|
| Sysmon     | Process Creation   | 1        | Execution of monitored processes       |
| Sysmon     | Network Connection | 3        | Connection attempts from local process |
| Winlogbeat | Log Forwarding     | -        | Transferred logs to Elasticsearch      |

---

## ğŸ“¨ Sample Alert
![Screenshot 2025-05-23 223742](https://github.com/user-attachments/assets/c02a870a-7e35-4650-8e5f-275eb59ed499)



---

## ğŸ›¡ï¸ Analyst Action on Alert

- âœ… Verified alerts in **ElastAlert logs**.
- âœ… Correlated **file paths, command line, and event IDs** in **Kibana Discover**.
- âœ… Investigated **process and connection behavior** for suspicious patterns.

---

## âš ï¸ Possible False Positives

| ğŸ§© Impact Area       | ğŸ“Œ Description                                                                 |
|----------------------|--------------------------------------------------------------------------------|
| Routine Scripts       | Scheduled tasks or admin scripts may match detection patterns.                |
| Network Utilities     | Legitimate tools (e.g., `ping`, `curl`) may trigger network alerts.           |
| Developer Activity    | Dev/test batch files run frequently during normal operations.                 |
| Penetration Testing   | Simulated attacks in red team exercises might overlap with detection criteria.|
| Monitoring Agents     | Endpoint agents or security tools may produce similar logs.                   |

---

## ğŸ› ï¸ Recommendations

- ğŸ” **Whitelist** known safe scripts and tools using hashes or specific file paths.
- ğŸ“Š **Refine rules** to target more specific patterns (e.g., parent process, command-line args).
- â³ **Rate-limit alerts** for repeated benign events to prevent alert fatigue.
- ğŸ“ˆ **Use thresholds** and **event correlation** over time windows to group events meaningfully.
- ğŸ” **Review and tune** detection rules regularly based on operational feedback and incident data.

---

## ğŸ§ª Detection Status

âœ… **Successfully Triggered**

ğŸ“¨ **ElastAlert** sent timely email alerts on:

- Simulated malware execution  
- Outbound network connection

